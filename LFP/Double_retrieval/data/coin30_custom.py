step_list = ['insert money into the vending machine', 'press the corresponding button', 'take out the goods', 'pour some water to the soy milk maker', 'pour some soy beans', 'run the soy milk maker', 'filtrate with a filter', 'pour into a glass', 'cross the rope to wrap the bolt', 'circle the rope under the bolt', 'strain the rope tightly', 'take out the plant', 'put in the plant', 'fill with some soil', 'trim the plant carefully', 'take out some rice', 'soak and wash the rice', 'put the washed rice into the rice cooker', 'cook the rice by rice cooker', 'install the wheels for the base', 'assemble the cushion and the backrest', 'connect the chair and the base', 'lift the barbell directly over the head', 'stand up with straight legs', 'pull the barbell to the chin', 'lift the barbell from the chin over the head', 'squat and hold the barbell', 'put down the barbell', 'pave the box bottom with paper scraps', 'set different kinds of hamster toys', 'put the hamster into the hamster cage', 'clean the hamster box', 'cover with some soil', 'sow on the soil', 'water and fertilize the seeds', 'dig some holes on the soil', 'apply a cover on the soil', 'prepare the soil carefully', 'apply shaving cream to the face', 'shave carefully on the face', 'wipe up the face', 'shave roughly on the face', 'do facial care carefully', 'apply cleansing milk to the face', 'add different kinds of ingredients', 'mix the raw materials', 'rub and drag the materials', 'remove the air nozzle', 'install the new air nozzle', 'inflate the tyre after replacement', 'deflate the tyre first', 'measure the size of the packing paper', 'cut the packing paper', 'stick with the tape and wrap', 'decorate the wrapped gift', 'apply the shampoo or hair conditioner', 'scratch the hair carefully', 'wet and wash the hair', 'make the hair dry', 'comb the hair with a comb', 'wrap the hair by hands', 'pin the hair with some hairpins', 'show the glass to the audience', 'block out the glass', 'show the vanished glass', 'ski down from the hill', 'rise to the sky', 'ski up from the hill', 'fall to the ground', 'wet and wash hands', 'add some cleaner to clean and wet the lenses and take out the lenses', 'wear the  contact lenses', 'add baking soda to the sink hole', 'add vinegar to the sink hole', 'add hot water to the sink hole', 'turn on the water tap to wash', 'pour the solution to the volumetric flask', 'fill the solution to the mark', 'seal the volumetric flask', 'invert the volumetric flask', 'fry or roast or braise', 'cut a hole on the shell', 'take out the shell', 'prepare and boil water', 'clean up and soak', 'pour some glue to the face', 'wipe the glue to a layer', 'reveal the glue from the face', 'thread thorugh the needle', 'twine round the thread', 'put the thread on the spool', 'begin to run up', 'do the first two jumps', 'do the third jump', 'use the body wash', 'wash the body wash away', 'smash the garlics with the knife face', 'cut up the garlics', 'peel off the garlics', 'pour some salt to the garlics', 'pull the ears outwards', 'insert the earplugs into the ears', 'roll and rub the earplugs', 'put on the shin guard sleeves or football socks', 'insert or put on the shin guard', 'wrap on the tape', 'put a slice of bread in', 'run the toaster and adjust', 'take out the slice of bread', 'raise the jack up', 'set the underprop', 'let the jack down', 'remove the underprop', 'remove the protecting cover of the gun head', 'insert the glue needle', 'hold the gun end and let the gun head aim at the tag brand', 'trigger and take out the needle head', 'insert the gun head']

step_label = {'insert money into the vending machine': 0, 'press the corresponding button': 1, 'take out the goods': 2, 'pour some water to the soy milk maker': 3, 'pour some soy beans': 4, 'run the soy milk maker': 5, 'filtrate with a filter': 6, 'pour into a glass': 7, 'cross the rope to wrap the bolt': 8, 'circle the rope under the bolt': 9, 'strain the rope tightly': 10, 'take out the plant': 11, 'put in the plant': 12, 'fill with some soil': 13, 'trim the plant carefully': 14, 'take out some rice': 15, 'soak and wash the rice': 16, 'put the washed rice into the rice cooker': 17, 'cook the rice by rice cooker': 18, 'install the wheels for the base': 19, 'assemble the cushion and the backrest': 20, 'connect the chair and the base': 21, 'lift the barbell directly over the head': 22, 'stand up with straight legs': 23, 'pull the barbell to the chin': 24, 'lift the barbell from the chin over the head': 25, 'squat and hold the barbell': 26, 'put down the barbell': 27, 'pave the box bottom with paper scraps': 28, 'set different kinds of hamster toys': 29, 'put the hamster into the hamster cage': 30, 'clean the hamster box': 31, 'cover with some soil': 32, 'sow on the soil': 33, 'water and fertilize the seeds': 34, 'dig some holes on the soil': 35, 'apply a cover on the soil': 36, 'prepare the soil carefully': 37, 'apply shaving cream to the face': 38, 'shave carefully on the face': 39, 'wipe up the face': 40, 'shave roughly on the face': 41, 'do facial care carefully': 42, 'apply cleansing milk to the face': 43, 'add different kinds of ingredients': 44, 'mix the raw materials': 45, 'rub and drag the materials': 46, 'remove the air nozzle': 47, 'install the new air nozzle': 48, 'inflate the tyre after replacement': 49, 'deflate the tyre first': 50, 'measure the size of the packing paper': 51, 'cut the packing paper': 52, 'stick with the tape and wrap': 53, 'decorate the wrapped gift': 54, 'apply the shampoo or hair conditioner': 55, 'scratch the hair carefully': 56, 'wet and wash the hair': 57, 'make the hair dry': 58, 'comb the hair with a comb': 59, 'wrap the hair by hands': 60, 'pin the hair with some hairpins': 61, 'show the glass to the audience': 62, 'block out the glass': 63, 'show the vanished glass': 64, 'ski down from the hill': 65, 'rise to the sky': 66, 'ski up from the hill': 67, 'fall to the ground': 68, 'wet and wash hands': 69, 'add some cleaner to clean and wet the lenses and take out the lenses': 70, 'wear the  contact lenses': 71, 'add baking soda to the sink hole': 72, 'add vinegar to the sink hole': 73, 'add hot water to the sink hole': 74, 'turn on the water tap to wash': 75, 'pour the solution to the volumetric flask': 76, 'fill the solution to the mark': 77, 'seal the volumetric flask': 78, 'invert the volumetric flask': 79, 'fry or roast or braise': 80, 'cut a hole on the shell': 81, 'take out the shell': 82, 'prepare and boil water': 83, 'clean up and soak': 84, 'pour some glue to the face': 85, 'wipe the glue to a layer': 86, 'reveal the glue from the face': 87, 'thread thorugh the needle': 88, 'twine round the thread': 89, 'put the thread on the spool': 90, 'begin to run up': 91, 'do the first two jumps': 92, 'do the third jump': 93, 'use the body wash': 94, 'wash the body wash away': 95, 'smash the garlics with the knife face': 96, 'cut up the garlics': 97, 'peel off the garlics': 98, 'pour some salt to the garlics': 99, 'pull the ears outwards': 100, 'insert the earplugs into the ears': 101, 'roll and rub the earplugs': 102, 'put on the shin guard sleeves or football socks': 103, 'insert or put on the shin guard': 104, 'wrap on the tape': 105, 'put a slice of bread in': 106, 'run the toaster and adjust': 107, 'take out the slice of bread': 108, 'raise the jack up': 109, 'set the underprop': 110, 'let the jack down': 111, 'remove the underprop': 112, 'remove the protecting cover of the gun head': 113, 'insert the glue needle': 114, 'hold the gun end and let the gun head aim at the tag brand': 115, 'trigger and take out the needle head': 116, 'insert the gun head': 117}

label_step = {0: 'insert money into the vending machine', 1: 'press the corresponding button', 2: 'take out the goods', 3: 'pour some water to the soy milk maker', 4: 'pour some soy beans', 5: 'run the soy milk maker', 6: 'filtrate with a filter', 7: 'pour into a glass', 8: 'cross the rope to wrap the bolt', 9: 'circle the rope under the bolt', 10: 'strain the rope tightly', 11: 'take out the plant', 12: 'put in the plant', 13: 'fill with some soil', 14: 'trim the plant carefully', 15: 'take out some rice', 16: 'soak and wash the rice', 17: 'put the washed rice into the rice cooker', 18: 'cook the rice by rice cooker', 19: 'install the wheels for the base', 20: 'assemble the cushion and the backrest', 21: 'connect the chair and the base', 22: 'lift the barbell directly over the head', 23: 'stand up with straight legs', 24: 'pull the barbell to the chin', 25: 'lift the barbell from the chin over the head', 26: 'squat and hold the barbell', 27: 'put down the barbell', 28: 'pave the box bottom with paper scraps', 29: 'set different kinds of hamster toys', 30: 'put the hamster into the hamster cage', 31: 'clean the hamster box', 32: 'cover with some soil', 33: 'sow on the soil', 34: 'water and fertilize the seeds', 35: 'dig some holes on the soil', 36: 'apply a cover on the soil', 37: 'prepare the soil carefully', 38: 'apply shaving cream to the face', 39: 'shave carefully on the face', 40: 'wipe up the face', 41: 'shave roughly on the face', 42: 'do facial care carefully', 43: 'apply cleansing milk to the face', 44: 'add different kinds of ingredients', 45: 'mix the raw materials', 46: 'rub and drag the materials', 47: 'remove the air nozzle', 48: 'install the new air nozzle', 49: 'inflate the tyre after replacement', 50: 'deflate the tyre first', 51: 'measure the size of the packing paper', 52: 'cut the packing paper', 53: 'stick with the tape and wrap', 54: 'decorate the wrapped gift', 55: 'apply the shampoo or hair conditioner', 56: 'scratch the hair carefully', 57: 'wet and wash the hair', 58: 'make the hair dry', 59: 'comb the hair with a comb', 60: 'wrap the hair by hands', 61: 'pin the hair with some hairpins', 62: 'show the glass to the audience', 63: 'block out the glass', 64: 'show the vanished glass', 65: 'ski down from the hill', 66: 'rise to the sky', 67: 'ski up from the hill', 68: 'fall to the ground', 69: 'wet and wash hands', 70: 'add some cleaner to clean and wet the lenses and take out the lenses', 71: 'wear the  contact lenses', 72: 'add baking soda to the sink hole', 73: 'add vinegar to the sink hole', 74: 'add hot water to the sink hole', 75: 'turn on the water tap to wash', 76: 'pour the solution to the volumetric flask', 77: 'fill the solution to the mark', 78: 'seal the volumetric flask', 79: 'invert the volumetric flask', 80: 'fry or roast or braise', 81: 'cut a hole on the shell', 82: 'take out the shell', 83: 'prepare and boil water', 84: 'clean up and soak', 85: 'pour some glue to the face', 86: 'wipe the glue to a layer', 87: 'reveal the glue from the face', 88: 'thread thorugh the needle', 89: 'twine round the thread', 90: 'put the thread on the spool', 91: 'begin to run up', 92: 'do the first two jumps', 93: 'do the third jump', 94: 'use the body wash', 95: 'wash the body wash away', 96: 'smash the garlics with the knife face', 97: 'cut up the garlics', 98: 'peel off the garlics', 99: 'pour some salt to the garlics', 100: 'pull the ears outwards', 101: 'insert the earplugs into the ears', 102: 'roll and rub the earplugs', 103: 'put on the shin guard sleeves or football socks', 104: 'insert or put on the shin guard', 105: 'wrap on the tape', 106: 'put a slice of bread in', 107: 'run the toaster and adjust', 108: 'take out the slice of bread', 109: 'raise the jack up', 110: 'set the underprop', 111: 'let the jack down', 112: 'remove the underprop', 113: 'remove the protecting cover of the gun head', 114: 'insert the glue needle', 115: 'hold the gun end and let the gun head aim at the tag brand', 116: 'trigger and take out the needle head', 117: 'insert the gun head'}

if __name__ == '__main__':
    import torch
    import clip
    from PIL import Image
    import numpy as np
    device = "cuda" if torch.cuda.is_available() else "cpu"
    print(device)
    model, preprocess = clip.load("ViT-B/32", device=device)
    text = clip.tokenize(step_list).to(device)

    with torch.no_grad():
        text_features = model.encode_text(text)

    print(text_features.shape)
    text_features = text_features.numpy()
    storage_path = '/nfs4-p1/ljt/github/PTU/Double_retrieval/language_sup/coin_features.npy'
    np.save(storage_path,text_features)
